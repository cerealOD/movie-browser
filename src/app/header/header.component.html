<header class="h-16 sm:h-20 shadow-lg bg-primary">
  <nav class="h-full p-4 lg:px-8 xl:container xl:px-16 flex justify-between items-center">
    <div class="flex items-center">
      <button (click)="headerService.toggleMenu();  $event.stopPropagation()" class="xl:hidden rounded-lg bg-secondary flex justify-center items-center h-8 w-8 sm:h-10 sm:w-10 mr-4 sm:mr-6">
        <img
          alt="Hamburger Menu Icon"
          src="hamburger.svg"
          class="icon absolute w-6 h-6 sm:w-7 sm:h-7 transition-all duration-200 ease-in-out"
          [class.opacity-0]="headerService.isMenuOpen()"

        />
        <img
          alt="Sidebar Close Icon"
          src="close.svg"
          class="icon absolute w-6 h-6 sm:w-7 sm:h-7 transition-all duration-200 ease-in-out opacity-0"
          [class.opacity-100]="headerService.isMenuOpen()"

        />
      </button>
      <a [routerLink]="['/']" class="w-[85px] sm:w-[120px] text-white text-3xl font-semibold">
        <img src="logo.svg" alt="Website Logo"/>
      </a>
      <div class="hidden xl:flex xl:ml-8 items-center gap-x-4">
        <a class="nav-link" [routerLink]="['movies/popular']" routerLinkActive="selected">
          Popular
        </a>
        <a class="nav-link" [routerLink]="['movies/top-rated']" routerLinkActive="selected">
         Top Rated
        </a>
        <a class="nav-link" [routerLink]="['movies/now-playing']" routerLinkActive="selected">
          Now Playing
        </a>
        <a class="nav-link" [routerLink]="['movies/upcoming']" routerLinkActive="selected">
          Upcoming
        </a>
      </div>
    </div>
    <div class="flex items-center gap-x-8">
      <form (ngSubmit)="onSearch()" class="hidden md:flex w-auto lg:w-[350px] xl:w-auto 2xl:w-[350px] items-center focus-within:shadow-[0_1px_15px_rgba(216,198,238,0.65)] transition-all rounded-xl">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          name="search"
          placeholder="Search movies..."
          class="bg-white placeholder:italic px-3 py-2 h-10 rounded-l-xl focus:outline-none text-primary flex-1 min-h-0"
        />
        <button type="submit" class="bg-secondary text-primary flex items-center w-10 h-10 flex-none justify-center rounded-r-xl">
          <i class="pi pi-search font-semibold"></i>
        </button>
      </form>
    @if (auth.isLoggedIn$ | async; ) {
      <div class="hidden sm:block relative" #dropdownWrapper>
        <button (click)="toggleDropdown($event)" class="bg-secondary text-primary  font-medium rounded-full w-10 h-10 flex items-center justify-center">{{initial()}}</button>
        @if (headerService.dropdownOpen()) {
          <div
            class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg z-50"
          >
            <ul class="text-sm text-gray-700">
              <li>
                <a (click)="headerService.close()" [routerLink]="['/favorites']" class="rounded-t-xl hover:bg-gray-200  profile-link">
                  Favorites
                </a>
              </li>
              <li>
                <button class="rounded-b-xl text-red-600 hover:bg-red-100 profile-link" (click)="logout()">
                  Log Out
                </button>
              </li>
            </ul>
          </div>
        }
      </div>
    } @else {
      <a [routerLink]="['/auth/login']" class="hidden sm:block shadow-lg rounded-lg bg-white px-4 py-2 text-primary font-semibold hover:bg-opacity-70 transition-basic">
        Log In
      </a>
      <a [routerLink]="['/auth/register']" class="hidden sm:block shadow-lg rounded-lg bg-secondary text-primary px-4 py-2 font-semibold hover:bg-opacity-70 transition-basic">
        Sign Up
      </a>
    }
    </div>
    <div class="side-menu flex flex-col" [class]="headerService.isMenuOpen() ? 'is-open': ''" #sideMenu>
      <form (ngSubmit)="onSearch()" class="flex items-center w-[300px] md:hidden">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          name="search"
          placeholder="Search movies..."
          class="rounded-none bg-white  min-w-0 flex-1 placeholder:italic pl-4 pr-3 h-12 focus:outline-none text-primary"
        />
        <button type="submit" class="bg-secondary text-primary flex items-center flex-none w-12 h-12 justify-center ">
          <i class="pi pi-search font-semibold"></i>
        </button>
      </form>
      @if (auth.isLoggedIn$ | async; ) {
        <a (click)="headerService.toggleMenu()" [routerLink]="['/favorites']" class="side-menu-link sm:hidden">
          Your Favorites
        </a>
      }
      <a (click)="headerService.toggleMenu()"  class="side-menu-link" [routerLink]="['movies/popular']" routerLinkActive="selected">
        Popular
      </a>
      <a (click)="headerService.toggleMenu()"  class="side-menu-link" [routerLink]="['movies/top-rated']" routerLinkActive="selected">
        Top Rated
      </a>
      <a (click)="headerService.toggleMenu()"  class="side-menu-link" [routerLink]="['movies/now-playing']" routerLinkActive="selected">
        Now Playing
      </a>
      <a (click)="headerService.toggleMenu()"  class="side-menu-link" [routerLink]="['movies/upcoming']" routerLinkActive="selected">
        Upcoming
      </a>
      @if (auth.isLoggedIn$ | async; ) {
        <button class="side-menu-logout" (click)="logout()">
          Log Out
        </button>
      } @else {
        <a (click)="headerService.toggleMenu()" [routerLink]="['/auth/login']" class="side-menu-link-auth">
          Log In
        </a>
        <a (click)="headerService.toggleMenu()" [routerLink]="['/auth/register']" class="side-menu-link-auth">
          Sign Up
        </a>
      }
    </div>
  </nav>
</header>
